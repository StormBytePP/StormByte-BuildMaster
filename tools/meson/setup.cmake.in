if(NOT EXISTS "@_MESON_BUILD_DIR@/build.ninja")
	message(STATUS "@_MESON_INDENT_@Configuring @_MESON_COMPONENT_TITLE@")
	execute_process(
		COMMAND @ENV_MESON_COMMAND@ setup "@_MESON_BUILD_DIR@" "@_MESON_SRCDIR@" "-Dc_args=@CMAKE_C_FLAGS@" "-Dcpp_args=@CMAKE_CXX_FLAGS@" "-Dc_link_args=@CMAKE_EXE_LINKER_FLAGS@" "-Dcpp_link_args=@CMAKE_EXE_LINKER_FLAGS@" "-Dbuildtype=@MESON_BUILD_TYPE@" "-Ddefault_library=@_MESON_LIBRARY_TYPE@" "--prefix=@BUILDMASTER_INSTALL_DIR@" "--libdir=@CMAKE_INSTALL_LIBDIR@" "-Db_lto=@LTO_ENABLED@" @_MESON_OPTIONS@
		RESULT_VARIABLE MESON_SETUP_RESULT
		OUTPUT_VARIABLE MESON_SETUP_OUT
		ERROR_VARIABLE MESON_SETUP_ERR
	)
	if(MESON_SETUP_ERR)
		message(WARNING "${MESON_SETUP_ERR}")
	endif()
	if(NOT MESON_SETUP_RESULT EQUAL 0)
		set(MESON_LOG_FILE "@_MESON_BUILD_DIR@/meson-logs/meson-log.txt")
		if(EXISTS "${MESON_LOG_FILE}")
			file(READ "${MESON_LOG_FILE}" MESON_LOG_CONTENT)
			message(FATAL_ERROR "Meson setup failed (exit ${MESON_SETUP_RESULT}). Meson log: ${MESON_LOG_FILE}\n${MESON_LOG_CONTENT}")
		else()
			message(FATAL_ERROR "Meson setup failed (exit ${MESON_SETUP_RESULT}). See meson output above for details.")
		endif()
	endif()
endif()
